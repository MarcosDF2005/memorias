<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Memoria Digital | Protocolo de Recuperaci√≥n</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="grid-overlay"></div>
<div class="scanline"></div>

<main id="app">
  <!-- Login -->
  <section id="login-screen" class="screen">
    <div class="cyber-card login-card">
      <h2 class="title-glow">MEMORIA DIGITAL</h2>
      <p class="subtitle">Inicia sesi√≥n para acceder</p>
      <form id="login-form" class="login-form" onsubmit="doLogin(event)">
        <div class="form-row">
          <label class="form-label">Usuario</label>
          <select name="username" class="form-input" id="login-username" required>
            <option value="">Selecciona qui√©n eres</option>
          </select>
        </div>
        <div class="form-row">
          <label class="form-label">Contrase√±a</label>
          <input type="password" name="password" class="form-input" placeholder="Tu contrase√±a" required>
        </div>
        <p id="login-error" class="login-error hidden"></p>
        <button type="submit" class="sci-fi-btn btn-login">ENTRAR</button>
      </form>
      <button type="button" class="sci-fi-btn secondary btn-guest" onclick="continueAsGuest()">Continuar sin login</button>
    </div>
  </section>

  <!-- Hub principal -->
  <section id="hub-screen" class="screen hidden">
    <div class="hub-user" id="hub-user">
      <span class="hub-status-dot" title="En l√≠nea"></span>
      <div class="hub-user-trigger">
        <div class="hub-user-main" onclick="toggleProfileMenu()">
          <img id="hub-avatar" class="hub-avatar" src="" alt="">
          <div class="hub-user-info">
            <span id="hub-name" class="hub-name"></span>
            <span id="hub-next-bday" class="hub-next-bday"></span>
          </div>
          <span class="hub-chevron">‚ñæ</span>
        </div>
        <div class="hub-profile-menu hidden" id="hub-profile-menu">
          <button type="button" class="menu-item" onclick="goToMyPortal()">üéÇ Mi portal</button>
          <button type="button" class="menu-item" onclick="openChangePassword()">üîê Cambiar contrase√±a</button>
          <div class="menu-colors" id="menu-colors"></div>
          <button type="button" class="menu-item menu-logout" onclick="doLogout()">SALIR</button>
        </div>
      </div>
      <div class="hub-notif-trigger">
        <div class="hub-notifications" id="hub-notifications" onclick="toggleNotifications()">
          <span class="notif-icon">üîî</span>
          <span class="notif-badge hidden" id="notif-badge">0</span>
        </div>
        <div class="hub-notif-dropdown hidden" id="hub-notif-dropdown"></div>
      </div>
    </div>
    <!-- Modal cambiar contrase√±a -->
    <div id="change-password-modal" class="modal-overlay hidden" onclick="if(event.target===this)closeChangePassword()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <h3>Cambiar contrase√±a</h3>
        <form onsubmit="submitChangePassword(event)">
          <div class="form-row">
            <label>Contrase√±a actual</label>
            <input type="password" name="currentPassword" required>
          </div>
          <div class="form-row">
            <label>Nueva contrase√±a</label>
            <input type="password" name="newPassword" minlength="4" required>
          </div>
          <p id="change-pw-error" class="login-error hidden"></p>
          <button type="submit" class="sci-fi-btn">GUARDAR</button>
        </form>
      </div>
    </div>
    <div class="cyber-card hub-card">
      <header class="card-header">
        <h2 class="title-glow">MEMORIA DIGITAL</h2>
        <p class="subtitle">SISTEMA DE RECUPERACI√ìN ¬∑ ESTADO: EN L√çNEA</p>
      </header>
      <nav class="hub-nav" id="hub-nav">
        <!-- Secciones generadas por JS -->
      </nav>
    </div>
  </section>

  <section id="selector-screen" class="screen hidden">
    <div class="cyber-card">
      <header class="card-header">
        <h2 class="title-glow">SISTEMA DE MEMORIA</h2>
        <p class="subtitle">ESTADO: EN L√çNEA</p>
        <button class="sci-fi-btn back-btn" onclick="goToHub()">‚Üê VOLVER</button>
      </header>
      <div class="selector-container" id="selector-container"></div>
    </div>
  </section>

  <section id="loading-screen" class="screen hidden">
    <div class="cyber-card small-card">
      <div id="terminal-output" class="terminal-text"></div>
      <div class="progress-container">
        <div id="progress-fill"></div>
      </div>
    </div>
  </section>

  <section id="portal-screen" class="screen hidden">
    <div class="cyber-card">
      <button class="sci-fi-btn back-btn" onclick="goToSelector()">‚Üê VOLVER</button>
      <div class="hud-frame">
        <img id="friend-avatar" src="" alt="Avatar">
      </div>
      <h1 id="data-name">---</h1>
      <div class="portal-buttons">
        <button id="access-btn" class="sci-fi-btn">RECONSTRUIR N√öCLEO</button>
        <button id="archivo-btn" class="sci-fi-btn secondary">ABRIR ARCHIVO</button>
      </div>
    </div>
  </section>

  <section id="capsule-screen" class="screen hidden">
    <div class="cyber-card wide-card">
      <div class="message-header">MENSAJE ENCRIPTADO REPRODUCIENDO...</div>
      <p id="personal-message"></p>
      <div class="photo-grid" id="photo-grid"></div>
      <div class="btn-footer">
        <button id="capsule-back-btn" class="sci-fi-btn">‚Üê VOLVER</button>
      </div>
    </div>
  </section>

  <!-- Calendario compartido -->
  <section id="calendar-screen" class="screen hidden">
    <div class="cyber-card wide-card calendar-card">
      <header class="card-header calendar-header">
        <button class="sci-fi-btn back-btn" onclick="goToHub()">‚Üê VOLVER</button>
        <h2 class="title-glow">CALENDARIO COMPARTIDO</h2>
        <p class="subtitle">Pulsa en un d√≠a para a√±adir</p>
        <div class="calendar-nav">
          <button type="button" class="calendar-arrow" onclick="changeCalendarMonth(-1)">‚Äπ</button>
          <span id="calendar-month-label"></span>
          <button type="button" class="calendar-arrow" onclick="changeCalendarMonth(1)">‚Ä∫</button>
        </div>
      </header>
      <div class="calendar-grid">
        <div class="calendar-weekdays">
          <span>Lun</span><span>Mar</span><span>Mi√©</span><span>Jue</span><span>Vie</span><span>S√°b</span><span>Dom</span>
        </div>
        <div id="calendar-days" class="calendar-days"></div>
      </div>
    </div>

    <!-- Modal para a√±adir en un d√≠a -->
    <div id="calendar-modal" class="calendar-modal hidden" onclick="if(event.target===this)closeCalendarModal()">
      <div class="calendar-modal-content" onclick="event.stopPropagation()">
        <h3 id="calendar-modal-title">A√±adir para el <span></span></h3>
        <form id="calendar-day-form" onsubmit="addCalendarioFromDay(event)">
          <input type="hidden" name="fecha">
          <select name="tipo">
            <option value="cumplea√±os">Cumplea√±os</option>
            <option value="vacaciones">Vacaciones</option>
            <option value="evento">Evento</option>
            <option value="examen">Examen</option>
            <option value="otro">Otro</option>
          </select>
          <input type="text" name="titulo" placeholder="T√≠tulo" required>
          <input type="text" name="descripcion" placeholder="Descripci√≥n (opcional)">
          <div class="modal-actions">
            <button type="button" class="sci-fi-btn secondary" onclick="closeCalendarModal()">Cerrar</button>
            <button type="submit" class="sci-fi-btn btn-add">A√ëADIR</button>
          </div>
        </form>
        <div id="calendar-day-entries" class="day-entries"></div>
      </div>
    </div>
  </section>

  <!-- Eventos del grupo -->
  <section id="eventos-screen" class="screen hidden">
    <div class="cyber-card wide-card eventos-card">
      <header class="card-header">
        <h2 class="title-glow">EVENTOS DEL GRUPO</h2>
        <p class="subtitle">Aniversarios, viajes, salidas importantes</p>
        <button class="sci-fi-btn back-btn" onclick="goToHub()">‚Üê VOLVER</button>
      </header>
      
      <div class="form-section">
        <h3 class="form-title">‚ûï A√±adir nuevo evento</h3>
        <form id="eventos-form" class="eventos-form" onsubmit="addEvento(event)">
          <div class="form-row">
            <label class="form-label">
              <span class="label-icon">üìÖ</span>
              <span class="label-text">Fecha</span>
            </label>
            <input type="date" name="fecha" class="form-input" required>
          </div>
          
          <div class="form-row">
            <label class="form-label">
              <span class="label-icon">üìå</span>
              <span class="label-text">T√≠tulo del evento</span>
            </label>
            <input type="text" name="titulo" class="form-input" placeholder="Ej: Viaje a la playa" required>
          </div>
          
          <div class="form-row">
            <label class="form-label">
              <span class="label-icon">üìù</span>
              <span class="label-text">Descripci√≥n</span>
              <span class="label-optional">(opcional)</span>
            </label>
            <textarea name="descripcion" class="form-input form-textarea" placeholder="Detalles del evento..."></textarea>
          </div>
          
          <div class="form-row">
            <label class="form-label">
              <span class="label-icon">üìç</span>
              <span class="label-text">Lugar</span>
              <span class="label-optional">(opcional)</span>
            </label>
            <input type="text" name="lugar" class="form-input" placeholder="Ej: Madrid, La China...">
          </div>
          
          <button type="submit" class="sci-fi-btn btn-add-full">
            <span>+</span> A√ëADIR EVENTO
          </button>
        </form>
      </div>
      
      <div class="events-section">
        <h3 class="section-title">üìã Eventos registrados</h3>
        <div id="eventos-list" class="content-list eventos-list"></div>
      </div>
    </div>
  </section>

  <!-- C√°psulas del tiempo -->
  <section id="capsulas-screen" class="screen hidden">
    <div class="cyber-card wide-card">
      <header class="card-header">
        <h2 class="title-glow">C√ÅPSULAS DEL TIEMPO</h2>
        <p class="subtitle">Mensajes que se abren en fechas concretas</p>
        <button class="sci-fi-btn back-btn" onclick="goToHub()">‚Üê VOLVER</button>
      </header>
      <div id="capsulas-list" class="content-list"></div>
    </div>
  </section>

  <!-- Archivo/Memorias de una persona -->
  <section id="memorias-screen" class="screen hidden">
    <div class="cyber-card wide-card">
      <header class="card-header">
        <h2 id="memorias-title" class="title-glow">ARCHIVO DE MEMORIAS</h2>
        <p id="memorias-subtitle" class="subtitle"></p>
        <button class="sci-fi-btn back-btn" onclick="showMemoriasBack()">‚Üê VOLVER</button>
      </header>
      <div id="memorias-list" class="content-list"></div>
    </div>
  </section>
</main>

<script src="js/app.js"></script>
</body>
</html>
